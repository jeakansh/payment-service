datasource db {
  provider = "postgresql"
  url      = "postgresql://postgres.ftzpbimcnbbjzntfvdcq:f19759a9-751f-4c4e-bfc1-6de36cf53d50@aws-1-ap-southeast-1.pooler.supabase.com:5432/postgres?pgbouncer=true&connection_limit=1"
}

generator client {
  provider = "prisma-client-js"
}

model Payment {
  id                  String    @id @default(uuid())
  tripId              String
  riderId             String
  referenceId         String? 
  amount              Decimal   @db.Decimal(12,2)
  currency            String
  status              PaymentStatus @default(PENDING)
  metadata            Json?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  method              PaymentMode
  refunds             Refund[]

  @@index([tripId])
  @@unique([tripId, riderId])
}


model Refund {
  id                 String   @id @default(uuid())
  paymentId          String
  providerRefundId   String?
  amount             Decimal  @db.Decimal(12,2)
  currency           String
  status             RefundStatus @default(PENDING)
  createdAt          DateTime @default(now())
  payment            Payment  @relation(fields: [paymentId], references: [id])
}


model IdempotencyKey {
  key          String   @id
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  status       String   // processing | succeeded | failed
  requestHash  String?
  response     Json?
}

enum PaymentStatus {
  PENDING
  SUCCEEDED
  FAILED
  RECONCILING
}

enum RefundStatus {
  PENDING
  SUCCEEDED
  FAILED
}

enum PaymentMode {
  UPI
  CARD
  CASH
  WALLET
}


